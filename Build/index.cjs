"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=e(require("node-fetch"));module.exports=class{async Login(e){let t={};try{const a=await r.default("https://www.codingame.com/services/Codingamer/loginSiteV2",{method:"POST",body:JSON.stringify([e.Email,e.Password,!0])});t=await a.json(),this.cookies=a.headers.raw()["set-cookie"].map((e=>e.split(";")[0])).join(";")}catch(e){return console.warn("There was an error when logging in Error:",e),e}if(t.userId||console.warn("No userId was found in the login result:",t),this.userId=t.userId,e.LoadUser){const e=await this.GetUserByHandle(t.codinGamer.publicHandle);if(!e.valid)return{valid:!1,error:new Error("Unknown Error!")};this.user=e.result}}async GetUserById(e){try{const t=await r.default("https://www.codingame.com/services/CodinGamer/findCodingamerFollowCard",{method:"POST",body:JSON.stringify([e,this.userId]),headers:{cookie:this.cookies}}),a=await t.json();return a&&a.publicHandle?await this.GetUserByHandle(a.publicHandle):{valid:!1,error:new Error("Not found")}}catch(e){return{valid:!1,error:e}}}async CreateClash(e){if(!this.UserId)return{valid:!1,error:new Error("You must be logged in to create clashes")};try{const t=await r.default("https://www.codingame.com/services/ClashOfCode/createPrivateClash",{method:"POST",body:JSON.stringify([this.UserId,{SHORT:!0},[],e||["FASTEST","SHORTEST","REVERSE"]]),headers:{cookie:this.cookies}});return{result:await t.json(),valid:!0}}catch(e){return{valid:!1,error:e}}}async GetClash(e){try{const t=await r.default("https://www.codingame.com/services/ClashOfCode/findClashByHandle",{method:"POST",body:JSON.stringify([e])});return{result:await t.json(),valid:!0}}catch(e){return{valid:!1,error:e}}}async GetNotifications(){if(!this.userId)return{valid:!1,error:new Error("You must be logged in to check notifications")};try{const e=await r.default("https://www.codingame.com/services/Notification/findUnreadNotifications",{method:"POST",body:[this.userId]});return{result:await e.json(),valid:!0}}catch(e){return{valid:!1,error:e}}}async Search(e){try{const t=await r.default("https://www.codingame.com/services/search/search",{method:"POST",body:JSON.stringify([e,"en",null])});return{result:await t.json(),valid:!0}}catch(e){return{valid:!1,error:e}}}async GetUserByHandle(e){try{const t=await(await r.default("https://www.codingame.com/services/CodinGamer/findCodingamePointsStatsByHandle",{method:"POST",body:JSON.stringify([e])})).json();return t.codingamer?{result:t.codingamer,valid:!0}:{valid:!1,error:new Error("User not found")}}catch(e){return{valid:!1,error:e}}}async GetUserByName(e){const r=await this.Search(e);if(null!=r)for(const t of r)return"USER"===t.type&&t.name===e?{result:await this.GetUserByHandle(t.id),valid:!0}:{valid:!1,error:new Error("User not found")}}async GetPendingClashes(){try{const e=await r.default("https://www.codingame.com/services/ClashOfCode/findPendingClashes",{method:"POST",body:JSON.stringify([])});return{result:await e.json(),valid:!0}}catch(e){return{valid:!1,error:e}}}constructor(e){e&&e.Email&&e.Password&&this.Login({Email:e.Email,Password:e.Password,LoadUser:e.LoadUser})}};
